"use strict";
function $24aec4d031e1098faadc41392624319f$var$_typeof(obj) {
    if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") $24aec4d031e1098faadc41392624319f$var$_typeof = function _typeof(obj1) {
        return typeof obj1;
    };
    else $24aec4d031e1098faadc41392624319f$var$_typeof = function _typeof1(obj1) {
        return obj1 && typeof Symbol === "function" && obj1.constructor === Symbol && obj1 !== Symbol.prototype ? "symbol" : typeof obj1;
    };
    return $24aec4d031e1098faadc41392624319f$var$_typeof(obj);
}
Object.defineProperty($24aec4d031e1098faadc41392624319f$exports, "__esModule", {
    value: true
});
$24aec4d031e1098faadc41392624319f$exports["default"] = void 0;
import   "24aec4d031e1098faadc41392624319f:micro-api-client";
var $24aec4d031e1098faadc41392624319f$var$_microApiClient = $24aec4d031e1098faadc41392624319f$var$_interopRequireWildcard($24aec4d031e1098faadc41392624319f$import$3bc0547a968b47e);
import   "24aec4d031e1098faadc41392624319f:./user.js";
var $24aec4d031e1098faadc41392624319f$var$_user = $24aec4d031e1098faadc41392624319f$var$_interopRequireDefault($24aec4d031e1098faadc41392624319f$import$9766212688d65bd6);
function $24aec4d031e1098faadc41392624319f$var$_interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        "default": obj
    };
}
function $24aec4d031e1098faadc41392624319f$var$_getRequireWildcardCache() {
    if (typeof WeakMap !== "function") return null;
    var cache = new WeakMap();
    $24aec4d031e1098faadc41392624319f$var$_getRequireWildcardCache = function _getRequireWildcardCache() {
        return cache;
    };
    return cache;
}
function $24aec4d031e1098faadc41392624319f$var$_interopRequireWildcard(obj) {
    if (obj && obj.__esModule) return obj;
    if (obj === null || $24aec4d031e1098faadc41392624319f$var$_typeof(obj) !== "object" && typeof obj !== "function") return {
        "default": obj
    };
    var cache = $24aec4d031e1098faadc41392624319f$var$_getRequireWildcardCache();
    if (cache && cache.has(obj)) return cache.get(obj);
    var newObj = {
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj)if (Object.prototype.hasOwnProperty.call(obj, key)) {
        var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
        if (desc && (desc.get || desc.set)) Object.defineProperty(newObj, key, desc);
        else newObj[key] = obj[key];
    }
    newObj["default"] = obj;
    if (cache) cache.set(obj, newObj);
    return newObj;
}
function $24aec4d031e1098faadc41392624319f$var$_classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) throw new TypeError("Cannot call a class as a function");
}
function $24aec4d031e1098faadc41392624319f$var$_defineProperties(target, props) {
    for(var i = 0; i < props.length; i++){
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
    }
}
function $24aec4d031e1098faadc41392624319f$var$_createClass(Constructor, protoProps, staticProps) {
    if (protoProps) $24aec4d031e1098faadc41392624319f$var$_defineProperties(Constructor.prototype, protoProps);
    if (staticProps) $24aec4d031e1098faadc41392624319f$var$_defineProperties(Constructor, staticProps);
    return Constructor;
}
var $24aec4d031e1098faadc41392624319f$var$HTTPRegexp = /^http:\/\//;
var $24aec4d031e1098faadc41392624319f$var$defaultApiURL = "/.netlify/identity";
var $24aec4d031e1098faadc41392624319f$var$GoTrue = /*#__PURE__*/ function() {
    function GoTrue() {
        var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
        }, _ref$APIUrl = _ref.APIUrl, APIUrl = _ref$APIUrl === void 0 ? $24aec4d031e1098faadc41392624319f$var$defaultApiURL : _ref$APIUrl, _ref$audience = _ref.audience, audience = _ref$audience === void 0 ? '' : _ref$audience, _ref$setCookie = _ref.setCookie, setCookie = _ref$setCookie === void 0 ? false : _ref$setCookie;
        $24aec4d031e1098faadc41392624319f$var$_classCallCheck(this, GoTrue);
        if (APIUrl.match($24aec4d031e1098faadc41392624319f$var$HTTPRegexp)) console.warn('Warning:\n\nDO NOT USE HTTP IN PRODUCTION FOR GOTRUE EVER!\nGoTrue REQUIRES HTTPS to work securely.');
        if (audience) this.audience = audience;
        this.setCookie = setCookie;
        this.api = new $24aec4d031e1098faadc41392624319f$var$_microApiClient["default"](APIUrl);
    }
    $24aec4d031e1098faadc41392624319f$var$_createClass(GoTrue, [
        {
            key: "_request",
            value: function _request(path) {
                var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
                };
                options.headers = options.headers || {
                };
                var aud = options.audience || this.audience;
                if (aud) options.headers['X-JWT-AUD'] = aud;
                return this.api.request(path, options)["catch"](function(error) {
                    if (error instanceof $24aec4d031e1098faadc41392624319f$var$_microApiClient.JSONHTTPError && error.json) {
                        if (error.json.msg) error.message = error.json.msg;
                        else if (error.json.error) error.message = "".concat(error.json.error, ": ").concat(error.json.error_description);
                    }
                    return Promise.reject(error);
                });
            }
        },
        {
            key: "settings",
            value: function settings() {
                return this._request('/settings');
            }
        },
        {
            key: "signup",
            value: function signup(email, password, data) {
                return this._request('/signup', {
                    method: 'POST',
                    body: JSON.stringify({
                        email: email,
                        password: password,
                        data: data
                    })
                });
            }
        },
        {
            key: "login",
            value: function login(email, password, remember) {
                var _this = this;
                this._setRememberHeaders(remember);
                return this._request('/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: "grant_type=password&username=".concat(encodeURIComponent(email), "&password=").concat(encodeURIComponent(password))
                }).then(function(response) {
                    $24aec4d031e1098faadc41392624319f$var$_user["default"].removeSavedSession();
                    return _this.createUser(response, remember);
                });
            }
        },
        {
            key: "loginExternalUrl",
            value: function loginExternalUrl(provider) {
                return "".concat(this.api.apiURL, "/authorize?provider=").concat(provider);
            }
        },
        {
            key: "confirm",
            value: function confirm(token, remember) {
                this._setRememberHeaders(remember);
                return this.verify('signup', token, remember);
            }
        },
        {
            key: "requestPasswordRecovery",
            value: function requestPasswordRecovery(email) {
                return this._request('/recover', {
                    method: 'POST',
                    body: JSON.stringify({
                        email: email
                    })
                });
            }
        },
        {
            key: "recover",
            value: function recover(token, remember) {
                this._setRememberHeaders(remember);
                return this.verify('recovery', token, remember);
            }
        },
        {
            key: "acceptInvite",
            value: function acceptInvite(token, password, remember) {
                var _this2 = this;
                this._setRememberHeaders(remember);
                return this._request('/verify', {
                    method: 'POST',
                    body: JSON.stringify({
                        token: token,
                        password: password,
                        type: 'signup'
                    })
                }).then(function(response) {
                    return _this2.createUser(response, remember);
                });
            }
        },
        {
            key: "acceptInviteExternalUrl",
            value: function acceptInviteExternalUrl(provider, token) {
                return "".concat(this.api.apiURL, "/authorize?provider=").concat(provider, "&invite_token=").concat(token);
            }
        },
        {
            key: "createUser",
            value: function createUser(tokenResponse) {
                var remember = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
                this._setRememberHeaders(remember);
                var user = new $24aec4d031e1098faadc41392624319f$var$_user["default"](this.api, tokenResponse, this.audience);
                return user.getUserData().then(function(userData) {
                    if (remember) userData._saveSession();
                    return userData;
                });
            }
        },
        {
            key: "currentUser",
            value: function currentUser() {
                var user = $24aec4d031e1098faadc41392624319f$var$_user["default"].recoverSession(this.api);
                user && this._setRememberHeaders(user._fromStorage);
                return user;
            }
        },
        {
            key: "verify",
            value: function verify(type, token, remember) {
                var _this3 = this;
                this._setRememberHeaders(remember);
                return this._request('/verify', {
                    method: 'POST',
                    body: JSON.stringify({
                        token: token,
                        type: type
                    })
                }).then(function(response) {
                    return _this3.createUser(response, remember);
                });
            }
        },
        {
            key: "_setRememberHeaders",
            value: function _setRememberHeaders(remember) {
                if (this.setCookie) {
                    this.api.defaultHeaders = this.api.defaultHeaders || {
                    };
                    this.api.defaultHeaders['X-Use-Cookie'] = remember ? '1' : 'session';
                }
            }
        }
    ]);
    return GoTrue;
}();
$24aec4d031e1098faadc41392624319f$exports["default"] = $24aec4d031e1098faadc41392624319f$var$GoTrue;
if (typeof window !== 'undefined') window.GoTrue = $24aec4d031e1098faadc41392624319f$var$GoTrue;
